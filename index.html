<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="./css/index.css" />
    <title>Lottery</title>
  </head>
  <style>
    body {
      font-size: 16px;
      width: 950px;
      margin-left: auto;
      margin-right: auto;
    }

    input {
      border: 0;
      border-radius: 0;
    }
  </style>

  <body>
    <div class="container-grid">
      <input
        type="text"
        class="bdr-nb-2 fs-18 text-center col-21 pt-1x pb-1x"
        placeholder="ป้อนหมายเลขกระดาษ"
      />
    </div>
    <div class="container-grid bdr-2 fw-bold text-center">
      <div class="col-1 bdr-ntlb-2 pt-1x pb-1x">ลำดับ</div>
      <div class="col-2 bdr-ntlb-2 pt-1x pb-1x c-darkblue">ตัวเลข</div>
      <div class="col-3 bdr-ntlb-2 pt-1x pb-1x c-crimson">ราคา</div>
      <div class="col-2 bdr-ntlb-2 pt-1x pb-1x c-darkblue">ตัวเลข</div>
      <div class="col-3 bdr-ntlb-2 pt-1x pb-1x c-crimson">ราคา</div>
      <div class="col-2 bdr-ntlb-2 pt-1x pb-1x c-darkblue">ตัวเลข</div>
      <div class="col-3 bdr-ntlb-2 pt-1x pb-1x c-crimson">ราคา</div>
      <div class="col-2 bdr-ntlb-2 pt-1x pb-1x c-darkblue">ตัวเลข</div>
      <div class="col-3 pt-1x pb-1x c-crimson">ราคา</div>
    </div>
    <div id="body-lot"></div>
    <div class="container-grid bdr-nt-2 fw-bold">
      <div class="col-1 bdr-ntlb-2 pt-1x pb-1x"></div>
      <div class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end c-darkorange">
        รวม1:&nbsp;&nbsp;
      </div>
      <div class="col-3 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end overflow-h">
        <span id="col1ForRow">0</span>&nbsp;&nbsp;
      </div>
      <div class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end c-darkorange">
        รวม2:&nbsp;&nbsp;
      </div>
      <div class="col-3 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end overflow-h">
        <span id="col2ForRow">0</span>&nbsp;&nbsp;
      </div>
      <div class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end c-darkorange">
        รวม3:&nbsp;&nbsp;
      </div>
      <div class="col-3 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end overflow-h">
        <span id="col3ForRow">0</span>&nbsp;&nbsp;
      </div>
      <div class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-end c-darkorange">
        รวม4:&nbsp;&nbsp;
      </div>
      <div class="col-3 fs-17 pt-1x pb-1x text-end overflow-h">
        <span id="col4ForRow">0</span>&nbsp;&nbsp;
      </div>
    </div>
    <div class="container-grid bdr-nt-2 fw-bold c-deeppink">
      <div class="col-6 fs-17 bdr-ntlb-2 text-end pt-1x pb-1x">
        ราคารวมทั้งหมด:&nbsp;&nbsp;
      </div>
      <div class="col-15 fs-17 pt-1x pb-1x">
        &nbsp;<span id="netPrice">0</span>&nbsp;บาท
      </div>
    </div>
  </body>
  <script>
    let columns = {
      col1ForRow: new Array(30),
      col2ForRow: new Array(30),
      col3ForRow: new Array(30),
      col4ForRow: new Array(30),
      total_col1ForRow: 0,
      total_col2ForRow: 0,
      total_col3ForRow: 0,
      total_col4ForRow: 0,
    };
    let netPrice = 0;
    function createBodyLot() {
      let bodyLot = document.getElementById("body-lot");
      for (let index = 1; index < 31; index++) {
        bodyLot.innerHTML += `
          <div class="container-grid bdr-nt-2">
            <div class="col-1 bdr-ntlb-2 fw-bold fs-18 pt-1x pb-1x text-center">${index}</div>
            <input id="col1ForNRow_${index}" type="text" class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-darkblue" 
            onchange="checkNumber(this.id, this.value)">
            <input id="col1ForRow_${index}" type="text" class="col-3 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-crimson" 
            oninput="this.value = this.value.toUpperCase();" onchange="checkValue(this.id, this.value)">
            <input id="col2ForNRow_${index}" type="text" class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-darkblue" 
            onchange="checkNumber(this.id, this.value)">
            <input id="col2ForRow_${index}" type="text" class="col-3 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-crimson" 
            oninput="this.value = this.value.toUpperCase();" onchange="checkValue(this.id, this.value)">
            <input id="col3ForNRow_${index}" type="text" class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-darkblue" 
            onchange="checkNumber(this.id, this.value)">
            <input id="col3ForRow_${index}" type="text" class="col-3 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-crimson" 
            oninput="this.value = this.value.toUpperCase();" onchange="checkValue(this.id, this.value)">
            <input id="col4ForNRow_${index}" type="text" class="col-2 bdr-ntlb-2 fs-17 pt-1x pb-1x text-center c-darkblue" 
            onchange="checkNumber(this.id, this.value)">
            <input id="col4ForRow_${index}" type="text" class="col-3 fs-17 pt-1x pb-1x text-center c-crimson" 
            oninput="this.value = this.value.toUpperCase();" onchange="checkValue(this.id, this.value)">
          </div>
        `;
      }
    }

    function checkNumber(id, value) {
      document.getElementById(id).value = value.replace(/[^0-9]/g, "");
    }

    function checkValue(id, value) {
      if (value != "") {
        let getPosition = id.split("_");
        columns[getPosition[0]][getPosition[1]] = addOrChangeValue(value);
        calculateColumn(getPosition[0]);
        document.getElementById(id).value = value.replace(
          /[^0-9Xx\u0e01\u0e25\u0e31\u0e1a]/g,
          ""
        );
      }
    }

    function increaseValue(value) {
      return parseInt(value[0]) + parseInt(value[1]);
    }

    function multiplyValue(value) {
      return parseInt(value[0]) * parseInt(value[1]);
    }

    function addOrChangeValue(newValue) {
      let nValue = newValue.split("X");
      if (nValue.length > 1) return formatValue(nValue);
      else return nValue[0].replace(/[^0-9Xx]/g, "");
    }

    function formatValue(value) {
      let nValue = [];
      Array.from(value).forEach((val) => {
        nValue.push(val.replace(/[^0-9Xx]/g, ""));
      });
      if (value[1].indexOf("กลับ") !== -1) return multiplyValue(nValue);
      else return increaseValue(nValue);
    }

    function calculateColumn(position) {
      let totalprice = 0;
      for (let index = 0; index < 30; index++) {
        let num = parseInt(columns[position][index]);
        totalprice += num ? num : 0;
      }
      document.getElementById(position).innerHTML = totalprice;
      columns[`total_${position}`] = totalprice;
      document.getElementById("netPrice").innerHTML =
        columns["total_col1ForRow"] +
        columns["total_col2ForRow"] +
        columns["total_col3ForRow"] +
        columns["total_col4ForRow"];
    }
    async function fetchXmlData() {
      try {
        const response = await fetch("https://calculate-server.vercel.app/xml");
        const xmlData = await response.text();
        document.getElementById("xmlData").innerText = xmlData;
        console.log(xmlData);
      } catch (error) {
        console.error("Error fetching XML data:", error.message);
      }
    }
    fetchXmlData();

    window.onload = createBodyLot;
  </script>
</html>
